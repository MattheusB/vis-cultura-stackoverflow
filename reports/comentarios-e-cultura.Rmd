---
title: "Comentários e cultura"
output:
    html_document:
    df_print: paged
theme: sandstone
---

```{r echo=FALSE, message=FALSE, warning=FALSE}
library(tidyverse)
library(here)
library(viridis)
theme_set(theme_bw())

knitr::opts_chunk$set(tidy = FALSE,
                      fig.width = 6,
                      fig.height = 5)
```

```{r read}
dados = read_csv(
    here::here("data/participation-per-country.csv"),
    col_types = cols(
        .default = col_double(),
        site = col_character(),
        country = col_character(),
        geo = col_character(),
        four_regions = col_character(),
        eight_regions = col_character(),
        six_regions = col_character(),
        `World bank income group 2017` = col_character()
    )
) %>% 
    filter(usuarios > 200)

dadosFiltrados <- dados %>% 
    filter(!is.na(Internet), !is.na(usuarios), !is.na(comentaram_prop), !is.na(six_regions))
glimpse(dados)
```

Estamos interessados na relação entre quanto as pessoas de diferentes países comentam em questões dos outros. A proporção das pessoas do país que comentou nas questões de outros está medido na variável `comentaram_prop`. 

Considerando essa variável, queremos examinar a relação entre ela e o quão hierárquicas são as relações em um país (`PDI`). Queremos também levar em conta o quanto as pessoas daquele país têm acesso à Internet (`Internet`) e qual o tamanho da base de dados que detectamos daquele país (`usuarios`). 

## Examinando essa relação

Faça uma visualização que usa os princípios de eficácia no projeto de visualizações para facilitar as comparações que você acha que são as mais importantes para entendermos esse contexto. 


```{r}
dadosFiltrados %>% 
    ggplot(mapping = aes(x = PDI, y = comentaram_prop, color = Internet, size = usuarios)) +
    geom_point(alpha = .6) +
    facet_grid(~site) + 
    labs(x = "Índice de Hierarquia nas Relações (PDI)", y = "Comentários proporcionais de cada país (%)", title = "Relação entre PDI e Proporção de comentários.") + 
    theme(plot.title = element_text(hjust = 0.5))
```

```{r echo=TRUE}
correlacoesPDI <- dadosFiltrados %>% 
    summarise(pearson = cor(PDI, comentaram_prop, method = "pearson", use = "pairwise.complete.obs"),
              kendall = cor(PDI, comentaram_prop, method = "kendall", use = "pairwise.complete.obs"),
              spearman = cor(PDI, comentaram_prop, method = "spearman", use = "pairwise.complete.obs"))
correlacoesPDI
```

```{r echo=TRUE}
correlacoesInternet <- dadosFiltrados %>% 
    summarise(pearson = cor(Internet, comentaram_prop, method = "pearson", use = "pairwise.complete.obs"),
              kendall = cor(Internet, comentaram_prop, method = "kendall", use = "pairwise.complete.obs"),
              spearman = cor(Internet, comentaram_prop, method = "spearman", use = "pairwise.complete.obs"))
correlacoesInternet
```

```{r echo=TRUE}
correlacoesUsuarios <- dadosFiltrados %>% 
    summarise(pearson = cor(usuarios, comentaram_prop, method = "pearson", use = "pairwise.complete.obs"),
              kendall = cor(usuarios, comentaram_prop, method = "kendall", use = "pairwise.complete.obs"),
              spearman = cor(usuarios, comentaram_prop, method = "spearman", use = "pairwise.complete.obs"))
correlacoesUsuarios
```

## Outras formas de ver

Em seguida, faça 5 visualizações que usem as mesmas variáveis e também pontos, mas que sejam **menos eficazes** que a que você escolheu acima. 

```{r}
dadosFiltrados %>% 
    ggplot(mapping = aes(fill=usuarios, x = country, y = PDI)) +
    geom_bar(position = "dodge", stat="identity") +
    theme(axis.text.x = element_text(angle = 90)) +
    labs(x = "Países", y = "Índice de Hierarquia nas Relações (PDI)", title = "Relação entre PDI e Países") +
    theme(plot.title = element_text(hjust = 0.5))
```

```{r}
dadosFiltrados %>% 
    ggplot(aes(color = comentaram_prop, size = PDI, x = Internet, y = usuarios)) +
    geom_point() +
    labs(x = "Internet", y = "Usuários", title = "Relação entre acesso a Internet e quantidade de Usuários") +
    theme(plot.title = element_text(hjust = 0.5))
```

```{r}
dadosFiltrados %>% 
    ggplot(mapping = aes(x = PDI, y = comentaram_prop, color = usuarios, size = Internet)) +
    geom_point() +
    facet_grid(site ~ four_regions) +
    labs(x = "Índice de Hierarquia nas Relações (PDI)", y = "Comentários proporcionais de cada país (%)", title = "Relação entre PDI e Comentários") +
    theme(plot.title = element_text(hjust = 0.5))
```

```{r}
dadosFiltrados %>% 
    ggplot(mapping = aes(x = comentaram_prop, y = PDI, alpha = Internet, size = usuarios, color = country)) +
    geom_point() +
    labs(x = "Comentários proporcionais de cada país (%)", y = "Índice de Hierarquia nas Relações (PDI)", title = "Relação entre Comentários e PDI.") +
    theme(plot.title = element_text(hjust = 0.5))
```
```{r}
dadosFiltrados %>% 
    ggplot(mapping = aes(x = comentaram_prop, y = PDI)) +
    geom_line() +
    geom_point(aes(color = Internet, size = usuarios), alpha = .6) +
    labs(x = "Comentários proporcionais de cada país (%)", y = "Índice Hierarquico nas Relações (PDI)", title = "Relação entre Comentários e PDI") +
    theme(plot.title = element_text(hjust = 0.5))
```
## Bônus

Inclua o continente dos países (`six_regions`) na visualização.

